#! /usr/bin/env bash
# Deployment variables for riffremote AWS instances

# Valid swarm names (used to index into OWNERS and IMAGE_VERS)
# keep alphabetical after 'riffai'
DEPLOY_NAMES=( riffai
               my
               boldly-app
               esme
               learningseeds
               learnlaunch
               nleadership
               roiinstitute
               ude-vet
             )

# OWNERS is an associative array of the DEPLOY_NAMES site owner names and email addresses
# Email is rot13. in vim use 'g?'
declare -A OWNERS
OWNERS=( [riffai.name]="Beth Porter"
         [riffai.email]="orgu@evssnanylgvpf.nv"
         [my.name]="Beth Porter"
         [my.email]="orgu@evssnanylgvpf.nv"
         [boldly-app.name]="Rebecca Grover"
         [boldly-app.email]="erorppn@ynagrearebhtr.bayvar"
         [esme.name]="Julia Henderson"
         [esme.email]="whyvn@rfzryrneavat.pbz"
         [learningseeds.name]="Erica Key"
         [learningseeds.email]="revpn@YrneavatFrrqf.pbz"
         [learnlaunch.name]="Ben Bungert"
         [learnlaunch.email]="ora@yrneaynhapu.pbz"
         [nleadership.name]="Ulrich Nettesheim"
         [nleadership.email]="Hyevpu@ayrnqrefuvc.pbz"
         [roiinstitute.name]="Patti Phillips"
         [roiinstitute.email]="cnggv@ebvvafgvghgr.arg"
         [ude-vet.name]="Esther Winther"
         [ude-vet.email]="wrffvpn.cnrffraf@hav-qhr.qr"
       )

# IMAGE_VERS is an associative array of the DEPLOY_NAMES image versions deployed on that instance
declare -A IMAGE_VERS
IMAGE_VERS=( [riffai.riffrtc]="3.0.0-dev.28"
             [riffai.riffdata]="2.0.0-dev.9"
             [my.riffrtc]="3.0.0-dev.28"
             [my.riffdata]="2.0.0-dev.9"
             [boldly-app.riffrtc]="3.0.0-dev.28"
             [boldly-app.riffdata]="2.0.0-dev.9"
             [esme.riffrtc]="3.0.0-dev.28"
             [esme.riffdata]="2.0.0-dev.9"
             [learningseeds.riffrtc]="3.0.0-dev.28"
             [learningseeds.riffdata]="2.0.0-dev.9"
             [learnlaunch.riffrtc]="3.0.0-dev.28"
             [learnlaunch.riffdata]="2.0.0-dev.9"
             [nleadership.riffrtc]="3.0.0"
             [nleadership.riffdata]="2.0.0-dev.10"
             [roiinstitute.riffrtc]="3.0.0-dev.28"
             [roiinstitute.riffdata]="2.0.0-dev.9"
             [ude-vet.riffrtc]="3.0.0-dev.28"
             [ude-vet.riffdata]="2.0.0-dev.9"
           )

# If we were given a swarm name as an argument, make sure that all the derived parameters are
# unset in case it is invalid, but leave them alone if no argument was given.
if [[ -n "$1" ]]
then
    REQ_DEPLOY=$1
    unset DEPLOY_SWARM
    unset RIFF_RTC_TAG
    unset RIFF_SERVER_TAG
else
    REQ_DEPLOY=$DEPLOY_SWARM
fi

if [ "$1" == "--clear" ]
then
    unset REQ_DEPLOY
    return
fi

# If we were given a valid swarm name as an argument, use it to populate the deployment environment vars
if [[ -v IMAGE_VERS[$REQ_DEPLOY.riffrtc] ]]
then
    export DEPLOY_SWARM=$REQ_DEPLOY
    # The docker-compose.yml file uses these values to determine which image to deploy to the swarm
    export RIFF_RTC_TAG=${IMAGE_VERS[$DEPLOY_SWARM.riffrtc]}
    export RIFF_SERVER_TAG=${IMAGE_VERS[$DEPLOY_SWARM.riffdata]}
fi
